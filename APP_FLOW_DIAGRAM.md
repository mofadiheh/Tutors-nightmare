# Application Flow Diagram

## User Journey

```
โโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโ
โ                        LANDING PAGE (/)                          โ
โ                                                                  โ
โ  โโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโ โ
โ  โ  ๐ Language-Learning Chatbot                              โ โ
โ  โ     Your AI-powered language tutor                         โ โ
โ  โโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโ โ
โ                                                                  โ
โ  โโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโ โ
โ  โ  Select Your Languages                                     โ โ
โ  โ                                                            โ โ
โ  โ  Primary Language (Learning):  [Dropdown: EN, ES, FR...] โ โ
โ  โ  Secondary Language (Speaking): [Dropdown: EN, ES, FR...] โ โ
โ  โโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโ โ
โ                                                                  โ
โ  โโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโ โ
โ  โ  Choose a Topic to Start                                  โ โ
โ  โ                                                            โ โ
โ  โ  [โ๏ธ  Travel]  [๐ Food]  [๐จ Hobbies]                    โ โ
โ  โ  [๐ผ Work]     [๐ญ Culture]                                โ โ
โ  โโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโ โ
โ                                                                  โ
โ  โโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโ โ
โ  โ  [๐ฌ Start Free Discussion]  (Large Button)                โ โ
โ  โโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโ โ
โ                                                                  โ
โโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโ
                              โ
                              โโ Click topic โ /chat?topic=travel&primary=es&secondary=en
                              โ
                              โโ Click free discussion โ /chat?primary=es&secondary=en
                              โ
                              โผ
โโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโ
โ                   CHAT PAGE (/chat?c=<id>)                       โ
โ                                                                  โ
โ  โโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโ โ
โ  โ  [๐ Home]  Language Tutor    [ES โ EN]  [๐ก Tutor Mode] โ โ
โ  โ             Status: โ Ready                                 โ โ
โ  โโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโ โ
โ  โโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโ โ
โ  โ  โโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโ                       โ โ
โ  โ  โ                                 โ  โ Messages Area      โ โ
โ  โ  โ  Assistant: ยกHola! ...          โ    (Scrollable)       โ โ
โ  โ  โโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโ    2:30 PM            โ โ
โ  โ                                                             โ โ
โ  โ                      โโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโ   โ โ
โ  โ                      โ User: Hola! Cรณmo estรกs?          โ  โ โ
โ  โ        2:31 PM       โโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโ   โ โ
โ  โ                                                             โ โ
โ  โ  โโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโ                       โ โ
โ  โ  โ Assistant: ยกMuy bien! ...       โ                       โ โ
โ  โ  โโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโ    2:31 PM            โ โ
โ  โโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโ โ
โ  โโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโ โ
โ  โ  [Type your message...                           ] [Send]  โ โ
โ  โโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโ โ
โ                                                                  โ
โโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโ
                              โ
                              โโ Click [ES โ EN] โ Toggle display language
                              โ   โ All messages re-render in English
                              โ
                              โโ Click [๐ก Tutor Mode] โ Modal or new conversation
                                  โ
                                  โผ
โโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโ
โ                        TUTOR MODE                                โ
โ                                                                  โ
โ  Option A: Modal/Sidebar with Insights                          โ
โ  โโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโ โ
โ  โ  ๐ Vocabulary from Conversation                           โ โ
โ  โ  โโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโ โ โ
โ  โ  โ  โธ Hola - Hello (greeting)                           โ โ โ
โ  โ  โ    Example: "ยกHola! Cรณmo estรกs?"                     โ โ โ
โ  โ  โ  โธ estรกs - you are (informal, present)              โ โ โ
โ  โ  โ    Example: "Cรณmo estรกs?"                            โ โ โ
โ  โ  โโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโ โ โ
โ  โ                                                            โ โ
โ  โ  ๐ Sentence Patterns                                      โ โ
โ  โ  โโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโ โ โ
โ  โ  โ  โธ ยฟCรณmo + verb? - How + verb?                       โ โ โ
โ  โ  โ    Example: "ยฟCรณmo estรกs?" = "How are you?"          โ โ โ
โ  โ  โโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโ โ โ
โ  โ                                                            โ โ
โ  โ  [Ask a Question]  [Close]                                โ โ
โ  โโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโ โ
โ                                                                  โ
โ  Option B: New Conversation (Tutor Q&A)                         โ
โ  โโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโ โ
โ  โ  Assistant: I'm here to answer questions about words,      โ โ
โ  โ  grammar, and phrases. What would you like to know?        โ โ
โ  โ                                                            โ โ
โ  โ  User: What's the difference between "estar" and "ser"?   โ โ
โ  โ                                                            โ โ
โ  โ  Assistant: Great question! Both mean "to be" but...      โ โ
โ  โโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโ โ
โ                                                                  โ
โโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโ
```

## API Endpoints Flow

### Phase 1 (Stubbed)
```
GET  /                          โ Landing page HTML
GET  /chat                      โ Chat page HTML
GET  /health                    โ {"ok": true}

GET  /api/topics?lang=XX        โ [{id, title, description}, ...]
POST /api/chat                  โ {conversation_id, assistant_text, ...}
POST /api/translate             โ {translated_text: "[Translated] ..."}
GET  /api/conversations/{id}    โ {conversation_id, messages: [...]}
```

### Phase 2 (Real Implementation)
```
Same endpoints, but:
- POST /api/chat calls LLM (OpenAI/Anthropic)
- POST /api/translate uses real translation (LLM or service)
- GET /api/conversations fetches from SQLite DB
- GET /api/insights/{id}?lang=XX generates vocabulary/patterns
```

## State Management

```
URL Parameters:
  - /chat?c=<uuid>              โ Conversation ID
  - /chat?topic=<id>            โ Topic selected from landing
  - /chat?mode=tutor            โ Tutor mode flag
  - /chat?primary=<lang>        โ Primary language
  - /chat?secondary=<lang>      โ Secondary language
  - /chat?display=<lang>        โ Current display language

LocalStorage:
  - languagePrefs: {primary, secondary}
  - lastConversationId: <uuid>
  - tempMessages: [...] (Phase 1 only)
  
Database (Phase 2):
  - conversations table
  - messages table
  - message_translations table
  - conversation_insights table
```

## Component Hierarchy

```
App
โโโ LandingPage
โ   โโโ Header
โ   โโโ LanguageSelector
โ   โ   โโโ PrimaryLanguageDropdown
โ   โ   โโโ SecondaryLanguageDropdown
โ   โโโ TopicStarters
โ   โ   โโโ TopicCard (x5)
โ   โโโ StartDiscussionButton
โ
โโโ ChatPage
    โโโ ChatHeader
    โ   โโโ HomeButton
    โ   โโโ LanguageToggle
    โ   โโโ TutorModeButton
    โโโ MessagesContainer
    โ   โโโ WelcomeMessage
    โ   โโโ MessageBubble (multiple)
    โ       โโโ UserMessage
    โ       โโโ AssistantMessage
    โโโ InputContainer
    โ   โโโ MessageInput
    โ   โโโ SendButton
    โโโ TutorModeModal (optional)
        โโโ VocabularyList
        โโโ PatternsList
        โโโ ActionButtons
```

## Milestone Progression

```
Phase 1: UI with Stubs
  โ A: Skeleton + Health check
  โฌ B: Landing page + Topics stub
  โฌ C: Chat page + Chat stub
  โฌ D: Language toggle + Translation stub
  โฌ E: Tutor mode UI + Insights stub
  โฌ F: Routing + State management
  โฌ G: Polish + Responsive design

Phase 2: Real Backend
  โฌ H: Database persistence
  โฌ I: LLM integration
  โฌ J: Real translation
  โฌ K: Insights generation
  โฌ L: Production polish
```
